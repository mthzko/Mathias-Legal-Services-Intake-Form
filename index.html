<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vinterra SMP – Legal Intake Form</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg: #0b0d10;
      --card: rgba(15,18,23,0.78);
      --panel: rgba(18,22,29,0.62);
      --muted: #a4acb6;
      --text: #eef1f6;
      --accent: #f1a1b7;
      --accent2: #b7a1b0;
      --accent-strong: #f7c2d1;
      --accent-soft: rgba(241,161,183,0.28);
      --accent-ghost: rgba(241,161,183,0.14);
      --bgGrad1: rgba(241,161,183,0.45);
      --bgGrad2: rgba(150,140,155,0.28);
      --bgGrad3: rgba(255,210,226,0.18);
      --defense-tint: rgba(143,209,179,0.16);
      --defense-border: rgba(143,209,179,0.45);
      --defense-border-strong: rgba(143,209,179,0.7);
      --danger: #ef4444;
      --border: rgba(255,255,255,0.10);
      --border-strong: rgba(255,255,255,0.18);
      --shadow: 0 22px 60px rgba(0,0,0,0.45);
      --shadow-soft: 0 10px 24px rgba(0,0,0,0.25);
      --radius: 16px;
      --bubble-width: 340px;
      --bubble-gap: 24px;
      --bubble-bg: rgba(14,18,24,0.78);
      --glass: rgba(255,255,255,0.06);
      --glass-strong: rgba(255,255,255,0.12);
      --shine: rgba(255,255,255,0.18);
      --transition: 220ms cubic-bezier(0.2,0.7,0.2,1);
      --transition-slow: 380ms cubic-bezier(0.2,0.7,0.2,1);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: "Space Grotesk", "Avenir Next", "Segoe UI", system-ui, -apple-system, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      --display: "Fraunces", "Space Grotesk", "Times New Roman", serif;
    }
    *{ box-sizing:border-box; }
    *::before,
    *::after{ box-sizing:border-box; }
    html{ scroll-behavior: smooth; }
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 15% -10%, var(--bgGrad1), transparent 55%),
        radial-gradient(900px 600px at 90% -5%, var(--bgGrad2), transparent 60%),
        radial-gradient(700px 520px at 70% 80%, var(--bgGrad3), transparent 55%),
        var(--bg);
      color:var(--text);
      line-height:1.4;
      min-height: 100vh;
      transition: background var(--transition-slow), color var(--transition);
    }
    body,
    button,
    input,
    textarea,
    select,
    .pill,
    .checks,
    .section,
    form,
    .output-bubble,
    .mode-card,
    .mode-btn,
    .ghost-link,
    .doc,
    .actions{
      transition:
        color var(--transition),
        background var(--transition),
        background-color var(--transition),
        border-color var(--transition),
        box-shadow var(--transition),
        transform var(--transition),
        opacity var(--transition),
        filter var(--transition);
    }
    @media (prefers-reduced-motion: reduce){
      *{
        transition-duration: 0.01ms !important;
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
      }
    }
    body.theme-light{
      color-scheme: light;
      --bg: #f2f3f6;
      --card: rgba(255,255,255,0.86);
      --panel: rgba(255,255,255,0.72);
      --muted: #5f6773;
      --text: #1c222f;
      --border: rgba(21,27,36,0.12);
      --border-strong: rgba(21,27,36,0.18);
      --shadow: 0 16px 40px rgba(12,16,22,0.12);
      --shadow-soft: 0 8px 20px rgba(12,16,22,0.10);
      --bubble-bg: rgba(255,255,255,0.8);
      --glass: rgba(255,255,255,0.7);
      --glass-strong: rgba(255,255,255,0.85);
      --shine: rgba(255,255,255,0.7);
      --defense-tint: rgba(143,209,179,0.22);
      --defense-border: rgba(143,209,179,0.55);
      --defense-border-strong: rgba(143,209,179,0.85);
    }
    body.theme-dark{
      color-scheme: dark;
    }
    .wrap{
      max-width: 980px;
      margin: 40px auto;
      padding: 0 18px 80px;
    }
    header{
      display:flex;
      justify-content:space-between;
      gap:16px;
      align-items:flex-start;
      margin-bottom: 18px;
    }
    h1{
      margin:0;
      font-size: clamp(22px, 3vw, 32px);
      letter-spacing:.2px;
      font-family: var(--display);
      font-weight: 700;
    }
    .sub{
      margin: 8px 0 0;
      color:var(--muted);
      max-width: 70ch;
      font-size: 14px;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 999px;
      background:
        linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.02)),
        var(--glass);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.12);
      color: var(--muted);
      font-size: 13px;
      user-select:none;
      white-space:nowrap;
    }
    .pill b{ color: var(--text); font-weight:600; }
    form{
      background:
        linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02)),
        var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(16px) saturate(130%);
      -webkit-backdrop-filter: blur(16px) saturate(130%);
      overflow:hidden;
    }
    .section{
      padding: 18px;
      border-top: 1px solid var(--border);
      background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.01));
    }
    .section:first-child{ border-top:0; }
    .section h2{
      margin:0 0 12px;
      font-size: 16px;
      color: var(--text);
      display:flex;
      align-items:center;
      gap:10px;
    }
    .section h2 span{
      font-size: 12px;
      color: var(--muted);
      font-weight: 500;
    }
    .grid{
      display:grid;
      gap: 12px;
    }
    @media (min-width: 760px){
      .grid.two{ grid-template-columns: 1fr 1fr; }
      .grid.three{ grid-template-columns: 1fr 1fr 1fr; }
    }
    label{
      display:block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    input[type="text"],
    input[type="date"],
    textarea,
    select{
      width:100%;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background:
        linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02)),
        var(--panel);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.08);
      color: var(--text);
      outline:none;
      backdrop-filter: blur(8px) saturate(140%);
      -webkit-backdrop-filter: blur(8px) saturate(140%);
    }
    textarea{
      min-height: 110px;
      resize: vertical;
    }
    input::placeholder, textarea::placeholder{ color: rgba(154,166,178,.6); }
    body.theme-light input::placeholder,
    body.theme-light textarea::placeholder{
      color: rgba(95,105,118,0.6);
    }
    input:focus, textarea:focus, select:focus{
      border-color: var(--accent-strong);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }
    .row{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .checks{
      display:flex;
      flex-wrap:wrap;
      gap: 10px 14px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background:
        linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)),
        var(--glass);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.08);
    }
    .checks label{
      margin:0;
      display:flex;
      gap:8px;
      align-items:center;
      color: var(--text);
      font-size: 13px;
      user-select:none;
    }
    .checks input{ accent-color: var(--accent); }
    .small{
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
    }
    .actions{
      padding: 16px 18px;
      border-top: 1px solid var(--border);
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:center;
      background:
        linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)),
        var(--glass);
    }
    button{
      border: 1px solid var(--border);
      background:
        linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.02)),
        var(--glass);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:600;
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
    }
    button:hover{
      border-color: var(--accent-strong);
      box-shadow:
        0 0 0 1px var(--accent-ghost),
        0 12px 26px rgba(0,0,0,0.25);
      transform: translateY(-1px);
    }
    button:active{ transform: translateY(0); }
    .primary{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-color: transparent;
      color:#0b0d10;
      box-shadow:
        0 12px 26px rgba(0,0,0,0.35),
        inset 0 1px 0 rgba(255,255,255,0.35);
    }

    /* Scary/defendant button style */
    .primary-defendant{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-color: transparent;
      color:#0b0d10;
      box-shadow:
        0 0 0 2px var(--accent-ghost),
        0 14px 32px rgba(0,0,0,0.35),
        0 0 20px var(--accent-soft);
    }

    .primary-defendant:hover{
      box-shadow:
        0 0 0 2px var(--accent-soft),
        0 16px 36px rgba(0,0,0,0.38),
        0 0 28px var(--accent-soft);
    }

    /* Make the inactive defendant tab still look a bit ominous */
    #tabDefendant:not(.primary-defendant){
      border-color: var(--defense-border);
      background: var(--defense-tint);
      color: var(--text);
    }

    #tabDefendant:not(.primary-defendant):hover{
      border-color: var(--defense-border-strong);
    }
    .danger{
      border-color: rgba(239,68,68,.45);
      color: #ffd7d7;
      background:
        linear-gradient(135deg, rgba(239,68,68,0.16), rgba(239,68,68,0.04)),
        rgba(239,68,68,.08);
    }
    .danger:hover{
      border-color: rgba(239,68,68,0.7);
      box-shadow:
        0 0 0 1px rgba(239,68,68,0.25),
        0 12px 26px rgba(0,0,0,0.25);
    }
    .right{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .muted{
      color: var(--muted);
      font-size: 13px;
    }
    .list{
      display:grid;
      gap:10px;
    }
    .item{
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .item input[type="text"]{ flex: 1; }
    .item button{ padding: 10px 10px; border-radius: 12px; }
    .divider{
      height:1px;
      background: var(--border);
      margin: 12px 0;
    }
    .error{
      display:none;
      margin-top:10px;
      padding: 10px 12px;
      border-radius: 12px;
      border:1px solid rgba(239,68,68,.45);
      background:
        linear-gradient(135deg, rgba(239,68,68,0.16), rgba(239,68,68,0.04)),
        rgba(239,68,68,.08);
      color:#ffd7d7;
      font-size: 13px;
    }
    .success{
      display:none;
      margin-top:10px;
      padding: 10px 12px;
      border-radius: 12px;
      border:1px solid rgba(88,173,151,0.4);
      background:
        linear-gradient(135deg, rgba(88,173,151,0.16), rgba(88,173,151,0.04)),
        rgba(88,173,151,0.08);
      color:#dffcf2;
      font-size: 13px;
    }
    pre{
      background:
        linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)),
        var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      overflow:auto;
      font-family: var(--mono);
      font-size: 12px;
      color: var(--text);
    }
    .footer-note{
      margin-top: 16px;
      color: var(--muted);
      font-size: 12px;
    }
    .kbd{
      font-family: var(--mono);
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 8px;
      border:1px solid var(--border);
      background:
        linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.02)),
        var(--glass);
      color: var(--text);
      display:inline-block;
    }

    .output-bubble{
      position: fixed;
      top: 110px;
      width: min(var(--bubble-width), 90vw);
      max-height: calc(100vh - 160px);
      padding: 14px;
      border: 1px solid var(--border-strong);
      border-radius: 18px;
      background:
        linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.02)),
        var(--bubble-bg);
      box-shadow: var(--shadow);
      backdrop-filter: blur(16px) saturate(140%);
      -webkit-backdrop-filter: blur(16px) saturate(140%);
      z-index: 50;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    body.bubble-right .output-bubble{
      right: var(--bubble-gap);
      left: auto;
    }

    body.bubble-left .output-bubble{
      left: var(--bubble-gap);
      right: auto;
    }

    .output-bubble h2{
      margin: 0 0 6px;
      font-size: 15px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .output-bubble h2 span{
      font-size: 11px;
      color: var(--muted);
      font-weight: 500;
    }

    .output-bubble .bubble-actions{
      margin: 4px 0 6px;
    }

    .output-bubble .doc{
      flex: 1 1 auto;
      min-height: 140px;
      overflow: auto;
    }

    .output-bubble .footer-note{
      margin-top: 8px;
    }

    @media (min-width: 1201px){
      body.bubble-right{
        padding-right: calc(var(--bubble-width) + var(--bubble-gap));
      }

      body.bubble-left{
        padding-left: calc(var(--bubble-width) + var(--bubble-gap));
      }
    }

    @media (max-width: 1200px){
      .output-bubble{
        position: static;
        top: auto;
        bottom: auto;
        left: auto;
        right: auto;
        width: 100%;
        max-height: none;
        margin: 16px 0;
      }

      body.bubble-right,
      body.bubble-left{
        padding-left: 0;
        padding-right: 0;
      }
    }

    /* Document-style output (what users actually see/send) */
    .doc{
      background:
        linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)),
        var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px;
      color: var(--text);
      font-size: 13px;
      line-height: 1.45;
      white-space: pre-wrap;
      word-break: break-word;
      font-family: var(--sans);
    }

    /* Theme swapping */
    body.theme-plaintiff{
      --accent: #f1a1b7;
      --accent2: #b7a1b0;
      --accent-strong: #f7c2d1;
      --accent-soft: rgba(241,161,183,0.28);
      --accent-ghost: rgba(241,161,183,0.14);
      --bgGrad1: rgba(241,161,183,0.52);
      --bgGrad2: rgba(148,138,152,0.30);
      --bgGrad3: rgba(255,214,230,0.22);
    }

    body.theme-defendant{
      --accent: #8fd1b3;
      --accent2: #7a9a90;
      --accent-strong: #b6efd7;
      --accent-soft: rgba(143,209,179,0.28);
      --accent-ghost: rgba(143,209,179,0.14);
      --bgGrad1: rgba(143,209,179,0.50);
      --bgGrad2: rgba(96,122,114,0.28);
      --bgGrad3: rgba(196,236,219,0.20);
    }

    body.theme-light.theme-plaintiff{
      --bgGrad1: rgba(245,167,188,0.55);
      --bgGrad2: rgba(188,178,189,0.35);
      --bgGrad3: rgba(255,224,236,0.35);
    }

    body.theme-light.theme-defendant{
      --bgGrad1: rgba(143,209,179,0.45);
      --bgGrad2: rgba(122,148,138,0.30);
      --bgGrad3: rgba(205,240,226,0.35);
    }

    /* Fullscreen "mode picker" overlay */
    .mode-overlay{
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px;
      background:
        radial-gradient(600px 400px at 20% 20%, rgba(255,255,255,0.08), transparent 60%),
        radial-gradient(500px 300px at 80% 10%, rgba(255,255,255,0.06), transparent 60%),
        rgba(7,10,14,0.88);
      backdrop-filter: blur(14px) saturate(120%);
      -webkit-backdrop-filter: blur(14px) saturate(120%);
      opacity: 1;
      transition: opacity var(--transition);
    }

    body.theme-light .mode-overlay{
      background:
        radial-gradient(600px 400px at 20% 20%, rgba(255,255,255,0.55), transparent 60%),
        radial-gradient(500px 300px at 80% 10%, rgba(255,255,255,0.45), transparent 60%),
        rgba(244,246,248,0.92);
    }

    .mode-overlay.hidden{
      opacity: 0;
      pointer-events: none;
    }

    .mode-card{
      width: min(720px, 100%);
      border: 1px solid var(--border-strong);
      border-radius: 20px;
      background:
        linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.02)),
        var(--card);
      box-shadow: var(--shadow);
      padding: 18px;
      backdrop-filter: blur(18px) saturate(140%);
      -webkit-backdrop-filter: blur(18px) saturate(140%);
    }

    .mode-card h2{
      margin: 0 0 8px;
      font-size: 18px;
      color: var(--text);
      display:flex;
      align-items:center;
      gap:10px;
    }

    .mode-card p{
      margin: 0 0 14px;
      color: var(--muted);
      font-size: 13px;
      max-width: 70ch;
    }

    .mode-actions{
      display: grid;
      gap: 12px;
    }

    @media (min-width: 760px){
      .mode-actions{ grid-template-columns: 1fr 1fr; }
    }

    .mode-btn{
      border: 1px solid var(--border);
      background:
        linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.02)),
        var(--glass);
      color: var(--text);
      padding: 14px 14px;
      border-radius: 16px;
      cursor: pointer;
      text-align: left;
      box-shadow: var(--shadow-soft);
    }

    .mode-btn:hover{
      transform: translateY(-1px);
      border-color: var(--border-strong);
      box-shadow:
        0 0 0 1px var(--accent-ghost),
        0 16px 30px rgba(0,0,0,0.25);
    }

    .mode-btn .title{
      font-weight: 800;
      font-size: 14px;
      display:block;
      margin-bottom: 6px;
    }

    .mode-btn .desc{
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
      display:block;
    }

    .mode-btn.plaintiff{
      background: linear-gradient(135deg, rgba(241,161,183,0.35), rgba(183,161,176,0.16));
    }

    .mode-btn.defendant{
      background: linear-gradient(135deg, rgba(143,209,179,0.35), rgba(122,154,144,0.16));
    }

    .mode-btn.plaintiff:hover{
      border-color: rgba(241,161,183,0.55);
      box-shadow:
        0 0 0 1px rgba(241,161,183,0.28),
        0 16px 30px rgba(0,0,0,0.25);
    }

    .mode-btn.defendant:hover{
      border-color: rgba(143,209,179,0.55);
      box-shadow:
        0 0 0 1px rgba(143,209,179,0.28),
        0 16px 30px rgba(0,0,0,0.25);
    }

    .mode-toolbar{
      margin-top: 12px;
      display:flex;
      justify-content: space-between;
      align-items:center;
      flex-wrap: wrap;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background:
        linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.02)),
        var(--glass);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.12);
    }

    .mode-toggle{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .mode-chip{
      font-size: 11px;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .mode-state{
      font-size: 12px;
      color: var(--text);
      font-weight: 600;
    }

    .switch{
      position: relative;
      width: 48px;
      height: 26px;
      display: inline-block;
    }

    .switch input{
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider{
      position: absolute;
      inset: 0;
      background:
        linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02)),
        rgba(0,0,0,0.25);
      border: 1px solid var(--border);
      border-radius: 999px;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.25);
      transition: background var(--transition), border-color var(--transition);
    }

    .slider::before{
      content: "";
      position: absolute;
      height: 20px;
      width: 20px;
      left: 3px;
      top: 2px;
      border-radius: 50%;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0.4)),
        var(--glass-strong);
      box-shadow:
        0 2px 8px rgba(0,0,0,0.35),
        inset 0 1px 0 rgba(255,255,255,0.6);
      transition: transform var(--transition), background var(--transition);
    }

    .switch input:checked + .slider{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-color: var(--accent-strong);
    }

    .switch input:checked + .slider::before{
      transform: translateX(22px);
    }

    .mode-footer{
      margin-top: 14px;
      display:flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      color: var(--muted);
      font-size: 12px;
    }

    .ghost-link{
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
    }

    .ghost-link:hover{ border-color: var(--accent-strong); }
  </style>
</head>

<body class="bubble-left theme-dark theme-plaintiff">
  <div class="mode-overlay" id="modeOverlay" aria-modal="true" role="dialog">
    <div class="mode-card">
      <h2>Pick a form <span style="font-size:12px; color: var(--muted); font-weight:500;">(yes, like a cookie banner, but useful)</span></h2>
      <p>
        Choose what you’re here for. This just quickly tailors the form and vibe to your situation.
      </p>

      <div class="mode-actions">
        <button type="button" class="mode-btn plaintiff" id="overlayPlaintiffBtn">
          <span class="title">I want to sue</span>
          <span class="desc">File a claim, submit evidence, list damages, demand emotional compensation.</span>
        </button>

        <button type="button" class="mode-btn defendant" id="overlayDefendantBtn">
          <span class="title">I got sued</span>
          <span class="desc">Respond to allegations, upload counter-evidence, choose outcomes, consider revenge litigation.</span>
        </button>
      </div>

      <div class="mode-toolbar">
        <div class="mode-toggle">
          <span class="mode-chip">Appearance</span>
          <label class="switch">
            <input type="checkbox" id="themeToggle" aria-label="Toggle dark mode" />
            <span class="slider"></span>
          </label>
          <span class="mode-state" id="themeState">Dark</span>
        </div>
        <span class="muted">Light or dark, pick your vibe.</span>
      </div>

      <div class="mode-footer">
        <span>Tip: You can switch tabs later. This just makes you pick something first.</span>
        <button type="button" class="ghost-link" id="overlayCloseBtn">Skip</button>
      </div>
    </div>
  </div>
  <div class="wrap">
    <header>
      <div>
        <h1>Vinterra SMP – Mathias' Legal Services' Intake Form</h1>
        <p class="sub">
          Fill this out before your lawyer (Mathias) even pretends to care. Clear info and real evidence makes your case stronger.
          “They were being weird” is not evidence. As long as it's not Taco.
        </p>
      </div>
 <div class="row" style="justify-content:flex-end; gap:10px;">
  <button type="button" id="tabPlaintiff" class="primary" style="padding:8px 12px; border-radius:999px;">
    I want to sue
  </button>
  <button type="button" id="tabDefendant" style="padding:8px 12px; border-radius:999px; font-weight:800;">
    I got sued
  </button>
  
</div>
    </header>
    <div id="outputTopAnchor">
      <aside class="output-bubble" aria-live="polite">
        <h2>Submission Output <span>(this is what gets sent)</span></h2>
        <div class="row bubble-actions">
          <button type="button" id="copyBtn">Copy Document</button>
          <button type="button" id="downloadBtn">Download Document</button>
          <button type="button" id="webhookBtn">Send to Discord</button>
          <label class="muted" style="display:inline-flex; gap:8px; align-items:center;">
            <input type="checkbox" id="autoWebhook" checked /> Auto-send on submit
          </label>
          <span class="muted">Copy: <span class="kbd">Ctrl</span>+<span class="kbd">C</span> works too.</span>
        </div>
        <div id="output" class="doc">No submission yet.</div>
        <div class="footer-note">
          Note: This document is your official submission record. Keep a copy for yourself.
        </div>
      </aside>
    </div>

    <form id="intakeForm" novalidate>
      <!-- Section 1: Client info -->
      <div class="section">
        <h2>Section 1: Client Information <span>(who is complaining)</span></h2>
        <div class="grid two">
          <div>
            <label for="clientIgn">In-Game Name (IGN) *</label>
            <input id="clientIgn" name="clientIgn" type="text" placeholder="e.g., MathiasK0" required />
          </div>
          <div>
            <label for="clientDiscord">Discord Username *</label>
            <input id="clientDiscord" name="clientDiscord" type="text" placeholder="e.g., mthzko or @Mathias" required />
          </div>
        </div>

        <div class="divider"></div>

        <div>
          <label>Are you the affected party? *</label>
          <div class="checks">
            <label><input type="radio" name="affectedParty" value="yes" required /> Yes</label>
            <label><input type="radio" name="affectedParty" value="no" required /> No</label>
          </div>
          <p class="small">If “No”, explain the connection below.</p>
        </div>

        <div>
          <label for="relationshipExplain">Connection / relationship (if not affected party)</label>
          <input id="relationshipExplain" name="relationshipExplain" type="text" placeholder="e.g., I'm filing on behalf of my friend / my shop / my chicken cult" />
        </div>
      </div>

      <!-- Section 2: Defendant info -->
      <div class="section">
        <h2>Section 2: Defendant Information <span>(who you’re suing)</span></h2>
        <div class="grid two">
          <div>
            <label for="defendantIgn">Defendant IGN *</label>
            <input id="defendantIgn" name="defendantIgn" type="text" placeholder="e.g., TACOWITHER" required />
          </div>
          <div>
            <label for="defendantAlts">Other person involved</label>
            <input id="defendantAlts" name="defendantAlts" type="text" placeholder="e.g., SoroF1ed and Foelligs." />
          </div>
        </div>
      </div>

      <!-- Section 3: Case type -->
      <div class="section">
        <h2>Section 3: Type of Case <span>(pick your poison)</span></h2>
        <div class="checks" id="caseTypes">
          <label><input type="checkbox" name="caseType" value="Griefing" /> Griefing (Blowing up your stuff)</label>
          <label><input type="checkbox" name="caseType" value="Theft" /> Theft (Taking your only Isac head)</label>
          <label><input type="checkbox" name="caseType" value="Property Damage" /> Property Damage (Burning down your BIG HORRENDOUS TREE)</label>
          <label><input type="checkbox" name="caseType" value="Endangerment" /> Endangerment (Not lighting their build = creepers gallore)</label>
          <label><input type="checkbox" name="caseType" value="Harassment" /> Harassment (TACOWITHER existing)</label>
          <label><input type="checkbox" name="caseType" value="Contract Dispute" /> Permit/Shop Dispute</label>
          <label><input type="checkbox" id="caseTypeOtherChk" /> Other</label>
        </div>
        <div style="margin-top:10px">
          <label for="caseTypeOther">Other (describe)</label>
          <input id="caseTypeOther" name="caseTypeOther" type="text" placeholder="e.g., 'Cut off every statue's head'" disabled />
        </div>
        <p class="small">You should select at least one. If you don’t, why are you here?</p>
      </div>

      <!-- Section 4: Incident details -->
      <div class="section">
        <h2>Section 4: Incident Details <span>(what happened, where, when)</span></h2>
        <div class="grid three">
          <div>
            <label for="incidentDateStart">Incident start date *</label>
            <input id="incidentDateStart" name="incidentDateStart" type="date" required />
          </div>
          <div>
            <label for="incidentDateEnd">Incident end date</label>
            <input id="incidentDateEnd" name="incidentDateEnd" type="date" />
          </div>
          <div>
            <label for="incidentLocation">Location (coords/landmark) *</label>
            <input id="incidentLocation" name="incidentLocation" type="text" placeholder="e.g., X: 6767 Z: -Aura / Winter Village" required />
          </div>
        </div>

        <div style="margin-top:12px">
          <label for="incidentDescription">Detailed description *</label>
          <textarea id="incidentDescription" name="incidentDescription" placeholder="Explain clearly: actions, sequence, what you saw, what was said. Keep it factual." required></textarea>
        </div>
      </div>

      <!-- Section 5: Evidence -->
      <div class="section">
        <h2>Section 5: Evidence Submitted <span>(links beat vibes)</span></h2>
        <div class="checks">
          <label><input type="checkbox" name="evidenceType" value="Video clips" /> Video clip(s)</label>
          <label><input type="checkbox" name="evidenceType" value="Screenshots" /> Screenshots</label>
          <label><input type="checkbox" name="evidenceType" value="Chat logs" /> Chat logs</label>
          <label><input type="checkbox" name="evidenceType" value="Witness statements" /> Witness statements</label>
          <label><input type="checkbox" id="evidenceOtherChk" /> Other</label>
        </div>
        <div style="margin-top:10px">
          <label for="evidenceOther">Other (describe)</label>
          <input id="evidenceOther" name="evidenceOther" type="text" placeholder="e.g., 'Map record', 'Chest history screenshot'" disabled />
        </div>

        <div class="divider"></div>

        <div>
          <label>Evidence links / descriptions (add as many as needed)</label>
          <div class="list" id="evidenceList"></div>
          <div class="row" style="margin-top:10px">
            <button type="button" id="addEvidenceBtn">+ Add evidence</button>
            <span class="muted">Examples: Medal link, Twitch clip, Discord attachment URL, description of where it is.</span>
          </div>
        </div>
      </div>

      <!-- Section 6: Witnesses -->
      <div class="section">
        <h2>Section 6: Witnesses <span>(people who saw it)</span></h2>
        <div>
          <label>Witness IGN(s)</label>
          <div class="list" id="witnessList"></div>
          <div class="row" style="margin-top:10px">
            <button type="button" id="addWitnessBtn">+ Add witness</button>
            <span class="muted">Witnesses should be willing to show up. If they ghost us that's on you.</span>
          </div>
        </div>
      </div>

      <!-- Section 7: Damages / outcome -->
      <div class="section">
        <h2>Section 7: Damages & Desired Outcome <span>(what you want)</span></h2>
        <div>
          <label for="damages">What (if anything) was lost or damaged? *</label>
          <textarea id="damages" name="damages" placeholder="List items/builds, quantity, and approximate effort/time if relevant." required></textarea>
        </div>

        <div style="margin-top:12px">
          <label>What are you seeking? *</label>
          <div class="checks" id="remedies">
            <label><input type="checkbox" name="remedy" value="Item/material replacement" /> Item/material replacement</label>
            <label><input type="checkbox" name="remedy" value="Financial compensation" /> Diamond compensation</label>
            <label><input type="checkbox" name="remedy" value="Forced rebuild/repair" /> Forced rebuild/repair</label>
            <label><input type="checkbox" name="remedy" value="Public apology" /> Public (humiliating) apology</label>
            <label><input type="checkbox" name="remedy" value="Injunction (stay away)" /> Chunk ban (applies to Taco every time)</label>
            <label><input type="checkbox" id="remedyOtherChk" /> Other</label>
          </div>
          <div style="margin-top:10px">
            <label for="remedyOther">Other (describe)</label>
            <input id="remedyOther" name="remedyOther" type="text" placeholder="e.g., 'Ban from voicechat for 2 weeks'" disabled />
          </div>
        </div>
      </div>

      <!-- Section 8: Extra notes -->
      <div class="section">
        <h2>Section 8: Additional Notes <span>(optional but helpful)</span></h2>
        <label for="notes">Anything else?</label>
        <textarea id="notes" name="notes" placeholder="Anything you think matters. Keep it relevant."></textarea>
      </div>

      <!-- Section 9: Declaration -->
      <div class="section">
        <h2>Section 9: Declaration <span>(don’t lie)</span></h2>
        <div class="checks">
          <label><input type="checkbox" id="truthCheck" required /> I confirm the info provided is truthful to the best of my knowledge.</label>
          <label><input type="checkbox" id="understandCheck" required /> I understand weak evidence/exaggeration hurts my case and Mathias' image.</label>
        </div>
        <div class="grid two" style="margin-top:12px">
          <div>
            <label for="signature">Signature (IGN) *</label>
            <input id="signature" name="signature" type="text" placeholder="Type your IGN" required />
          </div>
          <div>
            <label for="signDate">Date *</label>
            <input id="signDate" name="signDate" type="date" required />
          </div>
        </div>

        <div class="error" id="errorBox"></div>
        <div class="success" id="successBox"></div>
      </div>

      <div class="actions">
        <div class="muted">
          Tip: Remember to double check everything before submitting. Thx love.
        </div>
        <div class="right">
          <button type="button" class="danger" id="resetBtn">Reset</button>
          <button type="submit" class="primary">Submit Case</button>
        </div>
      </div>
    </form>
    <div id="outputBottomPlaintiff"></div>

    <form id="defendantForm" novalidate style="display:none; margin-top:16px;">
  <!-- DEFENDANT FORM: Section 1 -->
  <div class="section">
    <h2>Section 1: Defendant Information <span>(hi, yes, you’re being sued)</span></h2>
    <div class="grid two">
      <div>
        <label for="defIgn">Your IGN *</label>
        <input id="defIgn" name="defIgn" type="text" placeholder="e.g., TotallyInnocent" required />
      </div>
      <div>
        <label for="defDiscord">Your Discord *</label>
        <input id="defDiscord" name="defDiscord" type="text" placeholder="e.g., @defendant" required />
      </div>
    </div>

    <div style="margin-top:12px;">
      <label for="servedDate">Date you were served *</label>
      <input id="servedDate" name="servedDate" type="date" required />
    </div>
  </div>

  <!-- DEFENDANT FORM: Section 2 -->
  <div class="section">
    <h2>Section 2: Plaintiff & Claim <span>(who’s coming for your diamonds)</span></h2>
    <div class="grid two">
      <div>
        <label for="plaintiffIgn">Plaintiff IGN *</label>
        <input id="plaintiffIgn" name="plaintiffIgn" type="text" placeholder="e.g., MathiasK0" required />
      </div>
      <div>
        <label for="plaintiffDiscord">Plaintiff Discord</label>
        <input id="plaintiffDiscord" name="plaintiffDiscord" type="text" placeholder="e.g., @plaintiff" />
      </div>
    </div>

    <div style="margin-top:12px;">
      <label for="allegations">What are you being accused of? *</label>
      <textarea id="allegations" name="allegations" placeholder="Copy/paste the claim or describe it. Keep it clear." required></textarea>
    </div>
  </div>

  <!-- DEFENDANT FORM: Section 3 -->
  <div class="section">
    <h2>Section 3: Your Response <span>(your side of the story)</span></h2>

    <div>
      <label for="defResponse">Your version of events *</label>
      <textarea id="defResponse" name="defResponse" placeholder="What happened, in order, with locations/coords if possible." required></textarea>
    </div>

    <div class="divider"></div>

    <div>
      <label>Position *</label>
      <div class="checks">
        <label><input type="radio" name="position" value="deny" required /> Deny (didn’t happen / wasn’t me)</label>
        <label><input type="radio" name="position" value="partial" required /> Partial (some true, some not)</label>
        <label><input type="radio" name="position" value="admit" required /> Admit (but with explanation/mitigation)</label>
      </div>
    </div>

    <div style="margin-top:12px;">
      <label for="defenses">Defenses / reasons you think you shouldn’t lose *</label>
      <textarea id="defenses" name="defenses" placeholder="Examples: lack of proof, permission, misunderstanding, server rules." required></textarea>
    </div>
  </div>

  <!-- DEFENDANT FORM: Section 4 -->
  <div class="section">
    <h2>Section 4: Evidence & Witnesses <span>(proof beats confidence)</span></h2>

    <div class="checks">
      <label><input type="checkbox" name="defEvidenceType" value="Video clips" /> Video clip(s)</label>
      <label><input type="checkbox" name="defEvidenceType" value="Screenshots" /> Screenshots</label>
      <label><input type="checkbox" name="defEvidenceType" value="Chat logs" /> Chat logs</label>
      <label><input type="checkbox" id="defEvidenceOtherChk" /> Other</label>
    </div>

    <div style="margin-top:10px">
      <label for="defEvidenceOther">Other (describe)</label>
      <input id="defEvidenceOther" name="defEvidenceOther" type="text" placeholder="e.g., server log excerpt" disabled />
    </div>

    <div class="divider"></div>

    <div>
      <label>Evidence links / descriptions</label>
      <div class="list" id="defEvidenceList"></div>
      <div class="row" style="margin-top:10px">
        <button type="button" id="addDefEvidenceBtn">+ Add evidence</button>
        <span class="muted">Links, screenshots, clips, whatever. Just not “trust me bro”.</span>
      </div>
    </div>

    <div class="divider"></div>

    <div>
      <label>Witness IGN(s)</label>
      <div class="list" id="defWitnessList"></div>
      <div class="row" style="margin-top:10px">
        <button type="button" id="addDefWitnessBtn">+ Add witness</button>
        <span class="muted">Only list people who’ll actually show up.</span>
      </div>
    </div>
  </div>

  <!-- DEFENDANT FORM: Section 5 -->
  <div class="section">
    <h2>Section 5: What you want to happen <span>(damage control)</span></h2>

    <div>
      <label>Are you interested in a settlement? *</label>
      <div class="checks">
        <label><input type="radio" name="settlement" value="yes" required /> Yes</label>
        <label><input type="radio" name="settlement" value="no" required /> No</label>
        <label><input type="radio" name="settlement" value="maybe" required /> Maybe</label>
      </div>
    </div>

    <div style="margin-top:12px;">
      <label>Preferred outcome *</label>
      <div class="checks" id="defOutcomes">
        <label><input type="checkbox" name="defOutcome" value="Case dismissed" /> Case dismissed</label>
        <label><input type="checkbox" name="defOutcome" value="Reduced damages" /> Reduced damages</label>
        <label><input type="checkbox" name="defOutcome" value="Pay back / replace items" /> Pay back / replace items</label>
        <label><input type="checkbox" name="defOutcome" value="Public clarification/apology" /> Public clarification/apology</label>
        <label><input type="checkbox" name="defOutcome" value="Mediation" /> Mediation</label>
        <label><input type="checkbox" id="defOutcomeOtherChk" /> Other</label>
      </div>

      <div style="margin-top:10px">
        <label for="defOutcomeOther">Other (describe)</label>
        <input id="defOutcomeOther" name="defOutcomeOther" type="text" placeholder="e.g., schedule a rebuild day" disabled />
      </div>
    </div>

    <div style="margin-top:12px;">
      <label>Do you want to countersue? *</label>
      <div class="checks">
        <label><input type="radio" name="counter" value="no" required /> No</label>
        <label><input type="radio" name="counter" value="maybe" required /> Maybe</label>
        <label><input type="radio" name="counter" value="yes" required /> Yes</label>
      </div>

      <p class="small">If yes/maybe, explain below.</p>
      <textarea id="counterExplain" name="counterExplain" placeholder="Briefly explain why you want to countersue, and what for."></textarea>
    </div>
  </div>

  <!-- DEFENDANT FORM: Section 6 -->
  <div class="section">
    <h2>Section 6: Declaration <span>(still don’t lie)</span></h2>

    <div class="checks">
      <label><input type="checkbox" id="defTruthCheck" required /> I confirm the info provided is truthful to the best of my knowledge.</label>
      <label><input type="checkbox" id="defUnderstandCheck" required /> I understand lying will make this worse (somehow).</label>
    </div>

    <div class="grid two" style="margin-top:12px">
      <div>
        <label for="defSignature">Signature (IGN) *</label>
        <input id="defSignature" name="defSignature" type="text" placeholder="Type your IGN" required />
      </div>
      <div>
        <label for="defSignDate">Date *</label>
        <input id="defSignDate" name="defSignDate" type="date" required />
      </div>
    </div>

    <div class="error" id="defErrorBox"></div>
    <div class="success" id="defSuccessBox"></div>
  </div>

  <div class="actions">
    <div class="muted">Tip: Don’t rage-type. It reads like guilt.</div>
    <div class="right">
      <button type="button" class="danger" id="defResetBtn">Reset</button>
      <button type="submit" class="primary">Submit Defense</button>
    </div>
  </div>
</form>
    <div id="outputBottomDefendant"></div>
  </div>

  <script>
    // Helpers
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    const themeToggle = $("#themeToggle");
    const themeState = $("#themeState");

    function setAppearance(mode) {
      const isDark = mode === "dark";
      document.body.classList.toggle("theme-dark", isDark);
      document.body.classList.toggle("theme-light", !isDark);
      if (themeToggle) themeToggle.checked = isDark;
      if (themeState) themeState.textContent = isDark ? "Dark" : "Light";
      localStorage.setItem("appearance", isDark ? "dark" : "light");
    }

    const savedAppearance = localStorage.getItem("appearance");
    const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
    setAppearance(savedAppearance || (prefersDark ? "dark" : "light"));

    if (themeToggle) {
      themeToggle.addEventListener("change", (e) => {
        setAppearance(e.target.checked ? "dark" : "light");
      });
    }

    const outputBubble = document.querySelector(".output-bubble");
    const outputTopAnchor = document.getElementById("outputTopAnchor");
    const outputBottomPlaintiff = document.getElementById("outputBottomPlaintiff");
    const outputBottomDefendant = document.getElementById("outputBottomDefendant");
    const smallScreenQuery = window.matchMedia("(max-width: 1200px)");
    let outputMovedToBottom = false;

    function syncOutputPlacement() {
      if (!outputBubble || !outputTopAnchor) return;
      const plaintiffVisible = $("#intakeForm").style.display !== "none";
      const activeBottomAnchor = plaintiffVisible ? outputBottomPlaintiff : outputBottomDefendant;
      if (smallScreenQuery.matches) {
        if (outputMovedToBottom) {
          if (activeBottomAnchor) activeBottomAnchor.appendChild(outputBubble);
        } else {
          outputTopAnchor.appendChild(outputBubble);
        }
      } else {
        outputTopAnchor.appendChild(outputBubble);
      }
    }

    function scrollBubbleIntoView() {
      if (!outputBubble || !smallScreenQuery.matches) return;
      outputBubble.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    if (smallScreenQuery.addEventListener) {
      smallScreenQuery.addEventListener("change", syncOutputPlacement);
    } else if (smallScreenQuery.addListener) {
      smallScreenQuery.addListener(syncOutputPlacement);
    }
    window.addEventListener("resize", syncOutputPlacement);
    syncOutputPlacement();

    function todayISO() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${y}-${m}-${day}`;
    }

    function submissionFilenameBase(label) {
      const safeLabel = (label || "submission")
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/^-+|-+$/g, "") || "submission";
      const d = new Date();
      const y = d.getFullYear();
      const mo = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      const hh = String(d.getHours()).padStart(2, "0");
      const min = String(d.getMinutes()).padStart(2, "0");
      const sec = String(d.getSeconds()).padStart(2, "0");
      return `vinterra-${safeLabel}-${y}${mo}${day}-${hh}${min}${sec}`;
    }

    function show(el, msg) {
      el.style.display = "block";
      el.textContent = msg;
    }
    function hide(el) {
      el.style.display = "none";
      el.textContent = "";
    }

    function addListItem(container, placeholder, kind) {
      const row = document.createElement("div");
      row.className = "item";

      const input = document.createElement("input");
      input.type = "text";
      input.placeholder = placeholder;
      input.setAttribute("data-kind", kind);

      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "danger";
      btn.textContent = "Remove";
      btn.addEventListener("click", () => row.remove());

      row.appendChild(input);
      row.appendChild(btn);
      container.appendChild(row);
    }

    function getListValues(container, kind) {
      return Array.from(container.querySelectorAll(`input[data-kind="${kind}"]`))
        .map(i => i.value.trim())
        .filter(Boolean);
    }

    function downloadText(filename, text) {
      const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    // Discord webhook (CLIENT-SIDE WARNING: please don't abuse this volnerability inspect element wizards)
    const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1467289266391613472/iWFehe7bhU6W8x6ZOt6BlAcLzyUO3H32Ia4yj2-5GO_UOVvVYFWxLk6Q1ZbaNgDi770m";

    async function sendToDiscordWebhook(docText, filenameBase, contextLabel, statusEl) {
  if (!DISCORD_WEBHOOK_URL) {
    show(statusEl, "Discord webhook not configured. Ask Mathias to paste the webhook URL into the site code.");
    statusEl.classList.remove("success");
    statusEl.classList.add("error");
    statusEl.style.display = "block";
    return;
  }

  try {
    const fileBlob = new Blob([docText], { type: "text/plain" });
    const form = new FormData();

    const content = `${contextLabel} submission received: ${filenameBase}`;
    form.append("payload_json", JSON.stringify({ content }));

    form.append("files[0]", fileBlob, `${filenameBase}.txt`);

    const res = await fetch(DISCORD_WEBHOOK_URL, {
      method: "POST",
      body: form
    });

    if (!res.ok) {
      const text = await res.text().catch(() => "");
      throw new Error(`Discord webhook failed (${res.status}). ${text}`);
    }

    statusEl.classList.remove("error");
    statusEl.classList.add("success");
    show(statusEl, "Sent to Discord.");
  } catch (err) {
    statusEl.classList.remove("success");
    statusEl.classList.add("error");
    show(statusEl, `Discord send failed: ${err.message}`);
  }
}

    // Init
    const evidenceList = $("#evidenceList");
    const witnessList = $("#witnessList");

    // Defendant form init
const defEvidenceList = $("#defEvidenceList");
const defWitnessList = $("#defWitnessList");

// Start with one input each
addListItem(defEvidenceList, "Evidence link or description...", "defEvidence");
addListItem(defWitnessList, "Witness IGN...", "defWitness");

$("#addDefEvidenceBtn").addEventListener("click", () => {
  addListItem(defEvidenceList, "Evidence link or description...", "defEvidence");
});
$("#addDefWitnessBtn").addEventListener("click", () => {
  addListItem(defWitnessList, "Witness IGN...", "defWitness");
});

// Toggle Other fields
$("#defEvidenceOtherChk").addEventListener("change", (e) => {
  $("#defEvidenceOther").disabled = !e.target.checked;
  if (!e.target.checked) $("#defEvidenceOther").value = "";
});
$("#defOutcomeOtherChk").addEventListener("change", (e) => {
  $("#defOutcomeOther").disabled = !e.target.checked;
  if (!e.target.checked) $("#defOutcomeOther").value = "";
});

// Defaults
$("#defSignDate").value = todayISO();
$("#servedDate").value = todayISO();

// Tabs
const tabPlaintiff = $("#tabPlaintiff");
const tabDefendant = $("#tabDefendant");

function setTab(which) {
  const isPlaintiff = which === "plaintiff";
  $("#intakeForm").style.display = isPlaintiff ? "block" : "none";
  $("#defendantForm").style.display = isPlaintiff ? "none" : "block";

  // Swap theme
  document.body.classList.toggle("theme-plaintiff", isPlaintiff);
  document.body.classList.toggle("theme-defendant", !isPlaintiff);

  if (isPlaintiff) {
    tabPlaintiff.classList.add("primary");
    tabPlaintiff.classList.remove("primary-defendant");

    tabDefendant.classList.remove("primary");
    tabDefendant.classList.remove("primary-defendant");
  } else {
    tabDefendant.classList.add("primary-defendant");
    tabDefendant.classList.remove("primary");

    tabPlaintiff.classList.remove("primary");
    tabPlaintiff.classList.remove("primary-defendant");
  }
  syncOutputPlacement();
}

tabPlaintiff.addEventListener("click", () => setTab("plaintiff"));
tabDefendant.addEventListener("click", () => setTab("defendant"));

// Fullscreen mode picker overlay
const modeOverlay = $("#modeOverlay");
const overlayPlaintiffBtn = $("#overlayPlaintiffBtn");
const overlayDefendantBtn = $("#overlayDefendantBtn");
const overlayCloseBtn = $("#overlayCloseBtn");

function hideOverlay() {
  modeOverlay.classList.add("hidden");
  // Fully remove from layout after fade
  setTimeout(() => { modeOverlay.style.display = "none"; }, 260);
}

overlayPlaintiffBtn.addEventListener("click", () => {
  setTab("plaintiff");
  hideOverlay();
});

overlayDefendantBtn.addEventListener("click", () => {
  setTab("defendant");
  hideOverlay();
});

overlayCloseBtn.addEventListener("click", () => {
  // Default to plaintiff if they refuse to choose
  setTab("plaintiff");
  hideOverlay();
});

// Allow ESC to skip
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && modeOverlay.style.display !== "none") {
    setTab("plaintiff");
    hideOverlay();
  }
});

// On load, show overlay and ensure correct initial tab styling
setTab("plaintiff");

    // Start with one input each (people forget otherwise)
    addListItem(evidenceList, "Evidence link or description...", "evidence");
    addListItem(witnessList, "Witness IGN...", "witness");

    $("#addEvidenceBtn").addEventListener("click", () => {
      addListItem(evidenceList, "Evidence link or description...", "evidence");
    });
    $("#addWitnessBtn").addEventListener("click", () => {
      addListItem(witnessList, "Witness IGN...", "witness");
    });

    // Toggle the "Other" fields
    $("#caseTypeOtherChk").addEventListener("change", (e) => {
      $("#caseTypeOther").disabled = !e.target.checked;
      if (!e.target.checked) $("#caseTypeOther").value = "";
    });
    $("#evidenceOtherChk").addEventListener("change", (e) => {
      $("#evidenceOther").disabled = !e.target.checked;
      if (!e.target.checked) $("#evidenceOther").value = "";
    });
    $("#remedyOtherChk").addEventListener("change", (e) => {
      $("#remedyOther").disabled = !e.target.checked;
      if (!e.target.checked) $("#remedyOther").value = "";
    });

    // Default sign date to today
    $("#signDate").value = todayISO();

    // Reset
    $("#resetBtn").addEventListener("click", () => {
      $("#intakeForm").reset();
      $("#signDate").value = todayISO();

      // Clear lists and add defaults
      evidenceList.innerHTML = "";
      witnessList.innerHTML = "";
      addListItem(evidenceList, "Evidence link or description...", "evidence");
      addListItem(witnessList, "Witness IGN...", "witness");

      // Disable "other" inputs again
      $("#caseTypeOther").disabled = true;
      $("#evidenceOther").disabled = true;
      $("#remedyOther").disabled = true;

      $("#output").textContent = '{ "status": "Not submitted yet." }';
      hide($("#errorBox"));
      hide($("#successBox"));
      outputMovedToBottom = false;
      syncOutputPlacement();
    });

    // Defendant reset
$("#defResetBtn").addEventListener("click", () => {
  $("#defendantForm").reset();
  $("#defSignDate").value = todayISO();
  $("#servedDate").value = todayISO();

  defEvidenceList.innerHTML = "";
  defWitnessList.innerHTML = "";
  addListItem(defEvidenceList, "Evidence link or description...", "defEvidence");
  addListItem(defWitnessList, "Witness IGN...", "defWitness");

  $("#defEvidenceOther").disabled = true;
  $("#defOutcomeOther").disabled = true;

  hide($("#defErrorBox"));
  hide($("#defSuccessBox"));

  $("#output").textContent = '{ "status": "Not submitted yet." }';
  outputMovedToBottom = false;
  syncOutputPlacement();
});

    // Submit
    let lastSubmission = null;
    let lastPayload = null;
    let lastPayloadLabel = null;

    $("#intakeForm").addEventListener("submit", async (ev) => {
      ev.preventDefault();
      hide($("#errorBox"));
      hide($("#successBox"));

      // Basic validation
      const required = ["clientIgn", "clientDiscord", "defendantIgn", "incidentDateStart", "incidentLocation", "incidentDescription", "damages", "signature", "signDate"];
      for (const id of required) {
        const el = document.getElementById(id);
        if (!el.value.trim()) {
          show($("#errorBox"), `Missing required field: ${id}`);
          el.focus();
          return;
        }
      }

      const affected = $$('input[name="affectedParty"]:checked')[0]?.value;
      if (!affected) {
        show($("#errorBox"), "Select whether you are the affected party.");
        return;
      }
      if (affected === "no" && !$("#relationshipExplain").value.trim()) {
        show($("#errorBox"), "If you are not the affected party, explain your connection.");
        $("#relationshipExplain").focus();
        return;
      }

      const caseTypes = $$('input[name="caseType"]:checked').map(x => x.value);
      const caseOther = $("#caseTypeOtherChk").checked ? $("#caseTypeOther").value.trim() : "";
      if (caseOther) caseTypes.push(caseOther);
      if (caseTypes.length === 0) {
        show($("#errorBox"), "Select at least one case type (or use Other).");
        return;
      }

      const remedies = $$('input[name="remedy"]:checked').map(x => x.value);
      const remedyOther = $("#remedyOtherChk").checked ? $("#remedyOther").value.trim() : "";
      if (remedyOther) remedies.push(remedyOther);
      if (remedies.length === 0) {
        show($("#errorBox"), "Select at least one desired outcome (or use Other).");
        return;
      }

      if (!$("#truthCheck").checked || !$("#understandCheck").checked) {
        show($("#errorBox"), "You must accept both declaration checkboxes.");
        return;
      }

      const evidenceTypes = $$('input[name="evidenceType"]:checked').map(x => x.value);
      const evidenceOther = $("#evidenceOtherChk").checked ? $("#evidenceOther").value.trim() : "";
      if (evidenceOther) evidenceTypes.push(evidenceOther);

      const evidenceLinks = getListValues(evidenceList, "evidence");
      const witnesses = getListValues(witnessList, "witness");

      const start = $("#incidentDateStart").value;
      const end = $("#incidentDateEnd").value;
      if (end && end < start) {
        show($("#errorBox"), "Incident end date cannot be before the start date.");
        $("#incidentDateEnd").focus();
        return;
      }

      // Build submission
      lastSubmission = {
        submittedAt: new Date().toISOString(),
        client: {
          ign: $("#clientIgn").value.trim(),
          discord: $("#clientDiscord").value.trim(),
          affectedParty: affected === "yes",
          relationshipExplain: $("#relationshipExplain").value.trim() || null
        },
        defendant: {
          ign: $("#defendantIgn").value.trim(),
          alts: $("#defendantAlts").value.trim() || null
        },
        case: {
          types: caseTypes,
          incident: {
            startDate: start,
            endDate: end || null,
            location: $("#incidentLocation").value.trim(),
            description: $("#incidentDescription").value.trim()
          },
          evidence: {
            types: evidenceTypes,
            items: evidenceLinks
          },
          witnesses,
          damages: $("#damages").value.trim(),
          remedies,
          notes: $("#notes").value.trim() || null
        },
        declaration: {
          signature: $("#signature").value.trim(),
          date: $("#signDate").value
        }
      };

      const doc = buildPlaintiffDoc(lastSubmission);
      $("#output").textContent = doc;

      lastPayload = doc;
      lastPayloadLabel = "Plaintiff";

      show($("#successBox"), "Submitted. Copy the document, download it, or send it to Discord.");
      outputMovedToBottom = true;
      syncOutputPlacement();
      requestAnimationFrame(scrollBubbleIntoView);

      // Auto-send to Discord if enabled
      if ($("#autoWebhook").checked) {
        const filenameBase = submissionFilenameBase("plaintiff");
        await sendToDiscordWebhook(doc, filenameBase, "Plaintiff", $("#successBox"));
      }
    });

    function fmtList(arr) {
  if (!arr || arr.length === 0) return "(none)";
  return arr.map((x, i) => `${i + 1}. ${x}`).join("\n");
}

function buildPlaintiffDoc(s) {
  const end = s.case.incident.endDate ? ` to ${s.case.incident.endDate}` : "";
  return [
    "VINTERRA SMP – LEGAL INTAKE (PLAINTIFF)",
    "====================================",
    `Submitted: ${new Date(s.submittedAt).toLocaleString()}`,
    "",
    "CLIENT",
    "------",
    `IGN: ${s.client.ign}`,
    `Discord: ${s.client.discord}`,
    `Affected party: ${s.client.affectedParty ? "Yes" : "No"}`,
    s.client.relationshipExplain ? `Connection: ${s.client.relationshipExplain}` : null,
    "",
    "DEFENDANT",
    "---------",
    `IGN: ${s.defendant.ign}`,
    s.defendant.alts ? `Other involved: ${s.defendant.alts}` : null,
    "",
    "CASE SUMMARY",
    "------------",
    `Types: ${s.case.types.join(", ")}`,
    `Date(s): ${s.case.incident.startDate}${end}`,
    `Location: ${s.case.incident.location}`,
    "",
    "DESCRIPTION",
    "-----------",
    s.case.incident.description,
    "",
    "EVIDENCE",
    "--------",
    `Evidence types: ${s.case.evidence.types.length ? s.case.evidence.types.join(", ") : "(none selected)"}`,
    "Evidence items:",
    fmtList(s.case.evidence.items),
    "",
    "WITNESSES",
    "---------",
    fmtList(s.case.witnesses),
    "",
    "DAMAGES",
    "-------",
    s.case.damages,
    "",
    "REQUESTED OUTCOME",
    "-----------------",
    fmtList(s.case.remedies),
    "",
    "ADDITIONAL NOTES",
    "----------------",
    s.case.notes || "(none)",
    "",
    "DECLARATION",
    "-----------",
    `Signed by: ${s.declaration.signature}`,
    `Date: ${s.declaration.date}`
  ].filter((line) => line !== null && line !== undefined).join("\n");
}

function buildDefendantDoc(d) {
  return [
    "VINTERRA SMP – LEGAL INTAKE (DEFENDANT)",
    "====================================",
    `Submitted: ${new Date(d.submittedAt).toLocaleString()}`,
    "",
    "DEFENDANT",
    "---------",
    `IGN: ${d.defendant.ign}`,
    `Discord: ${d.defendant.discord}`,
    `Served date: ${d.defendant.servedDate}`,
    "",
    "PLAINTIFF",
    "---------",
    `IGN: ${d.plaintiff.ign}`,
    d.plaintiff.discord ? `Discord: ${d.plaintiff.discord}` : null,
    "",
    "ALLEGATIONS",
    "----------",
    d.claim.allegations,
    "",
    "RESPONSE",
    "--------",
    `Position: ${d.response.position}`,
    "",
    d.response.narrative,
    "",
    "DEFENSES",
    "--------",
    d.response.defenses,
    "",
    "EVIDENCE",
    "--------",
    `Evidence types: ${d.evidence.types.length ? d.evidence.types.join(", ") : "(none selected)"}`,
    "Evidence items:",
    fmtList(d.evidence.items),
    "Witnesses:",
    fmtList(d.evidence.witnesses),
    "",
    "RESOLUTION",
    "----------",
    `Settlement: ${d.resolution.settlement}`,
    "Preferred outcomes:",
    fmtList(d.resolution.outcomes),
    `Countersuit: ${d.resolution.counterSuit}`,
    d.resolution.counterExplain ? `Countersuit notes: ${d.resolution.counterExplain}` : null,
    "",
    "DECLARATION",
    "-----------",
    `Signed by: ${d.declaration.signature}`,
    `Date: ${d.declaration.date}`
  ].filter((line) => line !== null && line !== undefined).join("\n");
}

    // Defendant submit
let lastDefense = null;

$("#defendantForm").addEventListener("submit", async (ev) => {
  ev.preventDefault();
  hide($("#defErrorBox"));
  hide($("#defSuccessBox"));

  const required = ["defIgn", "defDiscord", "servedDate", "plaintiffIgn", "allegations", "defResponse", "defenses", "defSignature", "defSignDate"];
  for (const id of required) {
    const el = document.getElementById(id);
    if (!el.value.trim()) {
      show($("#defErrorBox"), `Missing required field: ${id}`);
      el.focus();
      return;
    }
  }

  const position = $$('input[name="position"]:checked')[0]?.value;
  if (!position) { show($("#defErrorBox"), "Pick your position (deny/partial/admit)."); return; }

  const settlement = $$('input[name="settlement"]:checked')[0]?.value;
  if (!settlement) { show($("#defErrorBox"), "Pick settlement preference."); return; }

  const counter = $$('input[name="counter"]:checked')[0]?.value;
  if (!counter) { show($("#defErrorBox"), "Pick whether you want to countersue."); return; }

  if (!$("#defTruthCheck").checked || !$("#defUnderstandCheck").checked) {
    show($("#defErrorBox"), "You must accept both declaration checkboxes.");
    return;
  }

  const defEvidenceTypes = $$('input[name="defEvidenceType"]:checked').map(x => x.value);
  const defEvidenceOther = $("#defEvidenceOtherChk").checked ? $("#defEvidenceOther").value.trim() : "";
  if (defEvidenceOther) defEvidenceTypes.push(defEvidenceOther);

  const defEvidenceItems = getListValues(defEvidenceList, "defEvidence");
  const defWitnesses = getListValues(defWitnessList, "defWitness");

  const outcomes = $$('input[name="defOutcome"]:checked').map(x => x.value);
  const outcomeOther = $("#defOutcomeOtherChk").checked ? $("#defOutcomeOther").value.trim() : "";
  if (outcomeOther) outcomes.push(outcomeOther);
  if (outcomes.length === 0) {
    show($("#defErrorBox"), "Select at least one preferred outcome (or use Other).");
    return;
  }

  lastDefense = {
    submittedAt: new Date().toISOString(),
    defendant: {
      ign: $("#defIgn").value.trim(),
      discord: $("#defDiscord").value.trim(),
      servedDate: $("#servedDate").value
    },
    plaintiff: {
      ign: $("#plaintiffIgn").value.trim(),
      discord: $("#plaintiffDiscord").value.trim() || null
    },
    claim: { allegations: $("#allegations").value.trim() },
    response: {
      position,
      narrative: $("#defResponse").value.trim(),
      defenses: $("#defenses").value.trim()
    },
    evidence: {
      types: defEvidenceTypes,
      items: defEvidenceItems,
      witnesses: defWitnesses
    },
    resolution: {
      settlement,
      outcomes,
      counterSuit: counter,
      counterExplain: $("#counterExplain").value.trim() || null
    },
    declaration: {
      signature: $("#defSignature").value.trim(),
      date: $("#defSignDate").value
    }
  };

  const doc = JSON.stringify(lastDefense, null, 2);
  $("#output").textContent = doc;

  // Track last payload for manual webhook send
  lastPayload = doc;
  lastPayloadLabel = "Defendant";

  show($("#defSuccessBox"), "Submitted. Copy the document, download it, or send it to Discord.");
  outputMovedToBottom = true;
  syncOutputPlacement();
  requestAnimationFrame(scrollBubbleIntoView);

  // Auto-send to Discord if enabled
  if ($("#autoWebhook").checked) {
    const filenameBase = submissionFilenameBase("defendant");
    await sendToDiscordWebhook(doc, filenameBase, "Defendant", $("#defSuccessBox"));
  }
});

    // Manual send to Discord
    $("#webhookBtn").addEventListener("click", async () => {
      // Decide which status box to use based on which form is currently visible
      const plaintiffVisible = $("#intakeForm").style.display !== "none";
      const statusEl = plaintiffVisible ? $("#successBox") : $("#defSuccessBox");

      hide($("#errorBox"));
      hide($("#defErrorBox"));

      if (!lastPayload) {
        show(statusEl, "Nothing to send yet. Submit a form first.");
        statusEl.classList.remove("success");
        statusEl.classList.add("error");
        statusEl.style.display = "block";
        return;
      }

      const filenameBase = submissionFilenameBase(
        lastPayloadLabel || (plaintiffVisible ? "Plaintiff" : "Defendant")
      );

      await sendToDiscordWebhook(lastPayload, filenameBase, lastPayloadLabel || "Submission", statusEl);
    });

    // Copy/download/mailto buttons
    $("#copyBtn").addEventListener("click", async () => {
      const text = $("#output").textContent;
      const plaintiffVisible = $("#intakeForm").style.display !== "none";
      const okEl = plaintiffVisible ? $("#successBox") : $("#defSuccessBox");
      const badEl = plaintiffVisible ? $("#errorBox") : $("#defErrorBox");
      try{
        await navigator.clipboard.writeText(text);
        show(okEl, "Copied to clipboard.");
      }catch(e){
        show(badEl, "Copy failed. Select the document and copy manually like it’s 2009.");
      }
    });

    $("#downloadBtn").addEventListener("click", () => {
      const text = $("#output").textContent;
      const plaintiffVisible = $("#intakeForm").style.display !== "none";
      const label = lastPayloadLabel || (plaintiffVisible ? "Plaintiff" : "Defendant");
      const filenameBase = submissionFilenameBase(label);
      downloadText(`${filenameBase}.json`, text);
      show(plaintiffVisible ? $("#successBox") : $("#defSuccessBox"), "Downloaded document file.");
    });

  </script>
</body>
</html>
